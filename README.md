# Hive-Movie - Catalog & Ticketing Engine ğŸ¬

> A high-performance core backend service responsible for managing the movie catalog, physical cinema infrastructure, and a highly concurrent seat reservation engine built with **.NET 10** and **C# 13**.

Hive-Movie acts as the transactional heart of the cinema ecosystem. It handles complex physical seating layouts, registers new movies and showtimes, and utilizes custom byte-level engine logic combined with Optimistic Concurrency Control to guarantee that race conditions and double-bookings are impossible during high-traffic ticket sales.

---

### ğŸ”— Associated Repositories

- ğŸ‘‰ **[Hive-Identity (Auth & Users)](https://www.google.com/search?q=https://github.com/Naveen2070/Hive-Identity)**
- ğŸ‘‰ **[EventHive UI (Frontend)](https://github.com/Naveen2070/EventHive-UI)**
- ğŸ‘‰ **[Hive-Event (Core API)](https://github.com/Naveen2070/EventHive)**

---

## ğŸš€ Key Features

- **ğŸŸï¸ High-Concurrency Ticketing:** Utilizes database-level Optimistic Concurrency Control (`RowVersion`) and a custom `SeatMapEngine` to ensure atomic reservations and prevent double-booking.
- **ğŸ’º Complex Auditorium Layouts:** Seamlessly stores custom seating topologies (disabled seats, wheelchair spots, aisles) using EF Core JSON column mapping and dynamic cross-property validation.
- **ğŸ›¡ï¸ Industrial-Grade Validation:** Combines native Data Annotations with **FluentValidation** to enforce strict physical boundaries (e.g., preventing a seat from being placed outside the room's maximum dimensions).
- **ğŸ§¯ Standardized Error Handling:** Fully compliant with **RFC 7807**. A centralized `IExceptionHandler` catches all domain and concurrency errors, returning predictable, beautifully formatted `ProblemDetails` JSON payloads without cluttered `try/catch` blocks.
- **ğŸ“š Rich OpenAPI Documentation:** Utilizes .NET 10 Document Transformers to automatically generate an industrial-grade **Scalar UI** portal, fully annotated with expected responses and JWT Bearer integration.

---

## ğŸ› ï¸ Tech Stack

- **Language:** C# 13
- **Framework:** .NET 10 (ASP.NET Core Web API)
- **Database:** SQL Server
- **ORM:** Entity Framework Core (with JSON column mapping)
- **Validation:** FluentValidation & Data Annotations
- **API Documentation:** OpenAPI (v3) / Scalar UI
- **Error Handling:** `IExceptionHandler` Middleware

---

## ğŸ—ï¸ Architecture

The project follows a clean, decoupled **Domain-Service** architecture. Business logic is strictly isolated from HTTP routing, and complex validations are separated from the core entity models:

```text
Hive_Movie
â”œâ”€â”€ Configuration     # Application startup & OpenAPI Document Transformers
â”œâ”€â”€ Controllers       # RESTful API routing (/api/{resource}/{id})
â”œâ”€â”€ Data              # EF Core DbContext, Seeders, and Migrations
â”œâ”€â”€ DTOs              # Immutable Data Transfer Objects (Records)
â”œâ”€â”€ Engine            # High-performance business logic (e.g., SeatMapEngine)
â”œâ”€â”€ Middleware        # Pipeline interceptors (GlobalExceptionHandler)
â”œâ”€â”€ Models            # Rich Domain Entities (Movie, Cinema, Auditorium, etc.)
â”œâ”€â”€ Services          # Decoupled business logic and CRUD abstractions
â””â”€â”€ Validators        # FluentValidation rules for complex cross-property checks
```

---

## ğŸ”’ Security Architecture: JWT Integration

Hive-Movie operates as a trusting resource server within the ecosystem. It does not issue tokens. Instead, it relies on the asymmetric/symmetric JWTs generated by the Kotlin **Hive-Identity** service.

- **Read Operations (`GET`):** Currently public for catalog browsing.
- **Mutating Operations (`POST`, `PUT`, `DELETE`):** Require a valid JWT Bearer token containing the appropriate Admin roles (Configuration coming in the next phase).

---

## âš™ï¸ Getting Started (How to Run)

### Prerequisites

- **.NET 10 SDK**
- **SQL Server** (LocalDB, Docker, or Cloud instance)

### 1. Clone the Repository

```bash
git clone https://github.com/Naveen2070/Hive-Movie.git
cd Hive-Movie
```

### 2. Database Configuration

Update the `DefaultConnection` string inside your `appsettings.Development.json` to point to your running SQL Server instance.

```json
"ConnectionStrings": {
  "DefaultConnection": "Server=localhost,1433;Database=HiveMovieDb;User Id=sa;Password=YourSecurePassword123!;TrustServerCertificate=True;"
}
```

### 3. Run Migrations & Start Application

Use the Entity Framework Core CLI to apply the database schema, then start the application. The `DbInitializer` will automatically seed the database with sample cinemas and movies on startup.

```bash
# Apply schema to SQL Server
dotnet ef database update

# Run the API
dotnet run
```

### 4. Access the Developer Portal

Navigate to the base URL (e.g., `https://localhost:5001/scalar`) to access the interactive **Scalar UI**. Here you can explore the fully documented endpoints, view payload schemas, and test the API directly from your browser.

---

## ğŸ”Œ API Endpoints

### ğŸ¬ Movies Catalog

| Method   | Endpoint           | Description                          | Access  |
| -------- | ------------------ | ------------------------------------ | ------- |
| `GET`    | `/api/movies`      | Get all active movies (Newest first) | Public  |
| `GET`    | `/api/movies/{id}` | Get movie details by ID              | Public  |
| `POST`   | `/api/movies`      | Register a new movie to the catalog  | Admin\* |
| `PUT`    | `/api/movies/{id}` | Full update of a movie's details     | Admin\* |
| `DELETE` | `/api/movies/{id}` | Soft-delete a movie from the catalog | Admin\* |

### ğŸ¢ Cinemas Management

| Method   | Endpoint            | Description                       | Access  |
| -------- | ------------------- | --------------------------------- | ------- |
| `GET`    | `/api/cinemas`      | Get all physical cinema locations | Public  |
| `GET`    | `/api/cinemas/{id}` | Get a specific cinema by ID       | Public  |
| `POST`   | `/api/cinemas`      | Register a new cinema location    | Admin\* |
| `PUT`    | `/api/cinemas/{id}` | Update cinema details             | Admin\* |
| `DELETE` | `/api/cinemas/{id}` | Soft-delete a cinema location     | Admin\* |

### ğŸ’º Auditoriums & Layouts

| Method   | Endpoint                       | Description                                    | Access  |
| -------- | ------------------------------ | ---------------------------------------------- | ------- |
| `GET`    | `/api/auditoriums`             | Get all auditoriums across all locations       | Public  |
| `GET`    | `/api/auditoriums/cinema/{id}` | Get all screens for a specific physical cinema | Public  |
| `GET`    | `/api/auditoriums/{id}`        | Get auditorium details and JSON seating layout | Public  |
| `POST`   | `/api/auditoriums`             | Create a new room with layout validation       | Admin\* |
| `PUT`    | `/api/auditoriums/{id}`        | Update room dimensions and seating layout      | Admin\* |
| `DELETE` | `/api/auditoriums/{id}`        | Soft-delete an auditorium                      | Admin\* |

### ğŸŸï¸ Showtimes & Ticketing

| Method | Endpoint                      | Description                              | Access |
| ------ | ----------------------------- | ---------------------------------------- | ------ |
| `GET`  | `/api/showtimes/{id}/seatmap` | Get real-time seat availability grid     | Public |
| `POST` | `/api/showtimes/{id}/reserve` | Reserve an array of specific coordinates | User\* |

_(Note: Endpoint authorization levels marked with an asterisk `_` are scheduled for the upcoming JWT integration phase).\*

---

**Built with â¤ï¸ by naveen**
